<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.38">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sean Maguire">
<meta name="dcterms.date" content="2022-03-24">

<title>Sean Maguire - Museums, antisocial behaviour, and DAGs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Sean Maguire</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html">About</a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/sm212"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Museums, antisocial behaviour, and DAGs</h1>
            <p class="subtitle lead">Do museums cause antisocial behaviour? No.&nbsp;If a model says museums do cause antisocial behaviour, should we trust it? Also no.</p>
                                <div class="quarto-categories">
                <div class="quarto-category">causal inference</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Sean Maguire </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 24, 2022</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#museums-and-antisocial-behaviour" id="toc-museums-and-antisocial-behaviour" class="nav-link active" data-scroll-target="#museums-and-antisocial-behaviour">Museums and antisocial behaviour</a></li>
  <li><a href="#whats-going-on-a-mental-model" id="toc-whats-going-on-a-mental-model" class="nav-link" data-scroll-target="#whats-going-on-a-mental-model">Whats going on? A mental model</a></li>
  <li><a href="#a-better-mental-model" id="toc-a-better-mental-model" class="nav-link" data-scroll-target="#a-better-mental-model">A better mental model</a></li>
  <li><a href="#dag-theory-101" id="toc-dag-theory-101" class="nav-link" data-scroll-target="#dag-theory-101">DAG theory 101</a></li>
  <li><a href="#the-gender-pay-gap" id="toc-the-gender-pay-gap" class="nav-link" data-scroll-target="#the-gender-pay-gap">The gender pay gap</a></li>
  <li><a href="#a-simulation" id="toc-a-simulation" class="nav-link" data-scroll-target="#a-simulation">A simulation</a></li>
  </ul>
</nav>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>If you’ve ever used linear regression, you’ve probably came across statements like “a one unit increase in <span class="math inline">\(x\)</span> causes a <span class="math inline">\(\beta\)</span> increase in <span class="math inline">\(y\)</span>”. But is this always the right thing to say? How can you be sure that changing <span class="math inline">\(x\)</span> causes <span class="math inline">\(y\)</span> to change?</p>
<p>A few months ago I went on a two day “causal inference workshop”, ran by the fabulous Economics Professor <a href="http://scunning.com/">Scott Cunningham</a>. I have zero background in economics, but Scott is a great teacher and I learnt a lot from the workshop (even if it did feel like drinking from a firehose at times!). One thing which really stuck with me is Scott’s use of DAGs - Directed Acyclic Graphs - and how they can be used to help clarify the “mental model” you use when you’re trying to do inference.</p>
<p>It’s easiest to show how DAGs work by doing examples. Before jumping in, I’d like to plug a book Scott is working on - <a href="http://www.scunning.com/cunningham_mixtape.pdf">Causal Inference: The Mixtape</a>. The book covers everything in this post &amp; much more, so if you find this sort of stuff interesting, go read the mixtape!</p>
<section id="museums-and-antisocial-behaviour" class="level1">
<h1>Museums and antisocial behaviour</h1>
<p>In the UK, most government organisations are really good at releasing data to the public. Two examples are</p>
<ul>
<li>The police collect monthly stats on police activity - available <a href="https://data.police.uk/data/">here</a> if you’re interested</li>
<li>The Department for Culture, Media, and Sport collect monthly visits to museums &amp; galleries - avaliable <a href="https://www.gov.uk/government/statistical-data-sets/museums-and-galleries-monthly-visits">here</a> if you’re interested</li>
</ul>
<p>Combining these together gives us one dataset with monthly figures for the number of musueum visits &amp; the number of “antisocial behaviour” crimes responded to by police officers. We can run a regression:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(antisocial <span class="sc">~</span> visits, <span class="at">data =</span> df)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Call:
lm(formula = antisocial ~ visits, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-24000 -15395  -7449  12726  37095 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 7.002e+04  2.301e+04   3.043  0.00474 **
visits      1.380e-02  5.549e-03   2.488  0.01845 * 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 18610 on 31 degrees of freedom
Multiple R-squared:  0.1664,    Adjusted R-squared:  0.1395 
F-statistic: 6.188 on 1 and 31 DF,  p-value: 0.01845</code></pre>
<p>There is a statistically significant relationship between museum visits and antisocial behaviour, and we’re able to say things like “increasing monthly museum visits by 1000 people will cause an extra 14 antisocial crimes”.</p>
<p>But do you believe this? Does it seem likely that museum visits causes antisocial behaviour? Should we ban museums? Should we stop school kids &amp; tourists from visiting museums?</p>
</section>
<section id="whats-going-on-a-mental-model" class="level1">
<h1>Whats going on? A mental model</h1>
<p>It’s important to realise what you’re doing when you run</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(antisocial <span class="sc">~</span> visits, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When you run this you are trying to fit a model, <code>antisocial ~ visits</code>, to some data, <code>df</code>. That model has some assumptions which you need to be aware of. In particular, you assume that</p>
<ul>
<li>there is a relationship between antisocial behaviour and museum visits, and</li>
<li>that the relationship is linear, so it looks like this: <span class="math inline">\(y_i = \beta_0 + \beta_1x_i + \epsilon_i\)</span></li>
</ul>
<p>If either of these assumptions aren’t true, you can end up with some pretty strange conclusions.</p>
<p>DAGs are really handy ways of writing down your assumptions. Here’s the DAG we assume when we use the model <code>antisocial ~ visits</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mod1.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Here’s the rules for drawing DAGs:</p>
<ul>
<li>Write down your independent variable, and all the variables you think matter</li>
<li>Draw arrows between the variables if you believe there is a causal link between them</li>
</ul>
<p>So for our mental model, we are assuming that the only thing what has a causal effect on antisocial behaviour is museum visits.</p>
</section>
<section id="a-better-mental-model" class="level1">
<h1>A better mental model</h1>
<p>Now that we’ve explicity stated our mental model, it doesn’t sound very realistic. Here’s another potential model:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mod2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Whenever you see a DAG, try to say in words what it’s telling you. This one is saying that there is a causal link between temperature and museum visits, and a causal link between temperature and antisocial behaviour. This model seems a bit more reasonable. There will be more people walking around on hot days. This gives more opportunities for people to visit a museum (e.g.&nbsp;someone walks past a museum and wanders in), and also more opportunities for antisocial behaviour (since there’s more potential victims).</p>
<p>Notice that there isn’t an arrow between museum visits and antisocial behaviour in our new model. This is another assumption we’re making. We are assuming that museum visits has no causal effect on antisocial behaviour. Given this assumption, it doesn’t really make sense to try to investigate the effect of museum visits on antisocial behaviour - there won’t be any!</p>
<p>Let’s see what happens when we add temperature to the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(antisocial <span class="sc">~</span> visits <span class="sc">+</span> avg_temp, <span class="at">data =</span> df)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>Call:
lm(formula = antisocial ~ visits + avg_temp, data = df)

Residuals:
   Min     1Q Median     3Q    Max 
-28300 -12112  -2595   8564  32713 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 9.617e+04  2.181e+04   4.408 0.000123 ***
visits      9.509e-04  6.326e-03   0.150 0.881525    
avg_temp    2.571e+03  8.065e+02   3.188 0.003343 ** 
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 16350 on 30 degrees of freedom
Multiple R-squared:  0.3773,    Adjusted R-squared:  0.3358 
F-statistic: 9.089 on 2 and 30 DF,  p-value: 0.0008204</code></pre>
<p>There’s no relationship between museum visits and antisocial behaviour - exactly as we said!</p>
</section>
<section id="dag-theory-101" class="level1">
<h1>DAG theory 101</h1>
<p>There is a lot of stuff going on behind the scenes with DAGs. If you want to learn about DAGs in detail, check out any book by <a href="https://www.amazon.co.uk/s?k=judea+pearl">Judea Pearl</a> or this great <a href="https://www.edx.org/course/causal-diagrams-draw-your-assumptions-before-your">course by Miguel Hernan</a>.</p>
<p>Here’s all the information you need to get started using DAGs. You need to know about <em>backdoor paths</em>, <em>colliders</em> and <em>confounders.</em></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="collider_confounder.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>If there is an arrow connecting two nodes together, we say that there is a direct path between the nodes. In the DAGs above, there are the following direct paths</p>
<ul>
<li>A <span class="math inline">\(\to\)</span> B</li>
<li>A <span class="math inline">\(\to\)</span> C</li>
<li>Y <span class="math inline">\(\to\)</span> X</li>
<li>Z <span class="math inline">\(\to\)</span> X</li>
</ul>
<p>Notice that there is no direct path between B &amp; C, but there is a way you can get from B to C (by going B <span class="math inline">\(\to\)</span> A <span class="math inline">\(\to\)</span> C). This indirect path is called a <em>backdoor path</em>. Backdoors can introduce bias in your model, so you need to make sure that you “shut” all the backdoors during the model stage.</p>
<p>There are two types of nodes on backdoor paths, colliders and confounders. Node A is an example of a confounder, since it has multiple arrows going out of it. Node X is an example of a collider, since there are multiple arrows “colliding” together at X.</p>
<p>You need to keep track of the different types of nodes along a backdoor path. Depending on what type of node is on the path, there are two ways to deal with backdoors:</p>
<ul>
<li>If the path contains one or more confounders, <em>add one of the confounders to the model</em>. You don’t need to add every confounder along the path into your model, just one</li>
<li>If the path contains one or more colliders, <em>do nothing</em>. Do not add the variables on the backdoor path to the model</li>
</ul>
<p>Armed with a bit of theory, let’s have another look at the models we fit earlier. Here’s our mental model for museum visits and antisocial bahaviour:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="mod2.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>And here’s the two models we fit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(antisocial <span class="sc">~</span> visits, <span class="at">data =</span> df)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(antisocial <span class="sc">~</span> visits <span class="sc">+</span> avg_temp, <span class="at">data =</span> df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Temperature is a confounder in our DAG. In <code>mod1</code> we don’t control for the counfounder, which introduces bias to the model. This bias made us incorrectly conclude that there was a significant relationship between museum visits and antisocial behaviour. In <code>mod2</code> we do control for the counfounder. This model is correctly specified, so there is no bias and we correctly conclude that there is no link between museum visits and antisocial behaviour.</p>
<p>This is the benefit of DAGs. By forcing you to write down all the assumed relationships before you start building models, you get a much better understanding of what variables you should include / exclude from the model.</p>
</section>
<section id="the-gender-pay-gap" class="level1">
<h1>The gender pay gap</h1>
<p><em>This example is lifted from chapter 3 of <a href="http://www.scunning.com/cunningham_mixtape.pdf">Causal Inference: The Mixtape</a>. The example originally comes from University of Liverpool Economist <a href="http://www.erinhengel.com/">Erin Hengel</a>. The only change I have made is converting the code from Stata to R.</em></p>
<p>There has been a lot of interest on the gender pay gap in recent years. If you’re not familiar, the gender pay gap is the gap between salary for men &amp; women - women tend to be paid less than men. The most common argument against the pay gap is that, once you control for job role, the gender pay gap disappears.</p>
<p>But is controlling for job role a valid thing to do? From the previous section, we saw that controlling on colliders will introduce bias to a model and potentially lead you to the wrong conclusion. Drawing a DAG will help us decide if we should control for job role.</p>
<p>Here’s one possible model:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="gender.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>There’s a lot going on here, so break it down:</p>
<ul>
<li>Only females receive discrimination</li>
<li>The occupation someone works in is affected by three things - any discrimination experienced, the persons intrinsic ability to do the job, and if the person is female</li>
<li>Wages are affected by the job the person works in, the persons intrinsic ability, and the level of discrimination the person receives</li>
</ul>
<p>These feel like reasonable assumptions - I wouldn’t want to work in a job where I’m discriminated or if I don’t have the ability to succeed at the job. I’d also be less likely to apply for a job if there was no-one like me working there. This is why there is an arrow between F <span class="math inline">\(\to\)</span> O. It’s saying that women are less likely to apply for jobs in male-dominated fields. The wage assumptions also make sense to me. I would expect a bus driver to be paid less than an astronaut. If someone is brilliant at their job, the company is more likely to pay them a higher salary so they keep working at the company.</p>
<p>There’s a fair few paths between D and W in this DAG, which will make listing all the backdoor paths tedious. Fortunately there is the <code>dagitty</code> package which does all the hard work for you. All you need to do is</p>
<ul>
<li>Specify all the nodes in the DAG. This is the <code>F;D;W;O;A</code> line in the code below</li>
<li>Next you start drawing all your arrows between the nodes. This is the <code>F -&gt; O</code> lines in the code below</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">'dag {</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="st">             F;D;W;O;A</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="st">                 </span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="st">             F -&gt; O</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="st">             F -&gt; D</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="st">             D -&gt; O</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="st">             D -&gt; W</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="st">             O -&gt; W</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="st">             A -&gt; O</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="st">             A -&gt; W</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="st">}'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now you can figure out all the paths between D and W by calling the paths function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">paths</span>(gender, <span class="at">from =</span> <span class="st">'D'</span>, <span class="at">to =</span> <span class="st">'W'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>p has two elements - <code>$paths</code> which lists all the paths between <code>D</code> and <code>W</code>, and <code>$open</code> which says if each path is open or closed. Here’s all the paths:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>paths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] "D -&gt; O -&gt; W"           "D -&gt; O &lt;- A -&gt; W"     
[3] "D -&gt; W"                "D &lt;- F -&gt; O -&gt; W"     
[5] "D &lt;- F -&gt; O &lt;- A -&gt; W"</code></pre>
<p>There’s the direct path <code>D -&gt; W</code> which we’re interested in, and 4 backdoor paths which might bias our model. Let’s have a look at which paths are open:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>paths[p<span class="sc">$</span>open]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] "D -&gt; O -&gt; W"      "D -&gt; W"           "D &lt;- F -&gt; O -&gt; W"</code></pre>
<p>And which paths are closed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>paths[<span class="sc">!</span>p<span class="sc">$</span>open]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>[1] "D -&gt; O &lt;- A -&gt; W"      "D &lt;- F -&gt; O &lt;- A -&gt; W"</code></pre>
<p>We need to close the open paths <code>D -&gt; O -&gt; W</code> and <code>D &lt;- F -&gt; O -&gt; W</code>. The easiest way to do this is to control on occupation <code>O</code>. But <code>O</code> is a collider on the closed paths <code>D -&gt; O &lt;- A -&gt; W</code> and <code>D &lt;- F -&gt; O &lt;- A -&gt; W</code>. Including <code>O</code> in the model will close the two open paths, but also open the two closed paths! We need to add another control in to close these newly opened backdoor paths, and we can do that by also controlling on <code>A</code>.</p>
<p>This tells us the correct model specification to use. We should run <code>wage ~ discrimination + occupation + ability</code>. Anything else will be biased and wrong.</p>
</section>
<section id="a-simulation" class="level1">
<h1>A simulation</h1>
<p>Unfortunately we can’t measure ability, since ability is unobserved. There isn’t a spreadsheet somewhere which scores how “able” someone is to perform their job.</p>
<p>As a check to see if <code>wage ~ discrimination + occupation + ability</code> is the correct model, we’re going to do a simulation. Simulations are really handy ways to check if we are fitting the right sort of model. We first simulate (make up) some data, where the independent variable is distributed with some parameters <em>which we set</em>. We then fit a model to this data, and see how close the model parameters are to the true parameters. If we have specified the model correctly, the model parameters should match up with the actual parameters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="co"># Simulate 10,000 observations</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>female <span class="ot">&lt;-</span> <span class="fu">runif</span>(n) <span class="sc">&gt;</span> <span class="fl">0.5</span> <span class="co"># Set 50% of the observations to female</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>ability <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n) <span class="co"># Ability is normally distributed</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>discrimination <span class="ot">&lt;-</span> female <span class="co"># All women experience discrimination</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Occupation depends on ability, discrimination, and if </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># the person is female</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>occupation <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> ability <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> discrimination <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> female <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Wage depends on discrimination, occupation, and ability</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>wage <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> discrimination <span class="sc">+</span> <span class="dv">1</span> <span class="sc">*</span> occupation <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> ability <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If our model is correct, we should get a coefficient of <code>-1</code> on the discrimination term, a coefficient of <code>+1</code> on the <code>occupation</code> term, and <code>+2</code> on the <code>ability</code> term. Let’s fit 3 models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> discrimination)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> discrimination <span class="sc">+</span> occupation)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(wage <span class="sc">~</span> discrimination <span class="sc">+</span> occupation <span class="sc">+</span> ability)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>texreg</code> package makes a nice regression table we can use to compare the models. It shows the coeffecient estimates for each model along with their standard errors (the number in brackets). It also puts little stars next to the estimates to show if a parameter estimate is significant or not:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>texreg<span class="sc">::</span><span class="fu">screenreg</span>(<span class="fu">list</span>(mod1, mod2, mod3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>============================================================
                Model 1       Model 2       Model 3     
------------------------------------------------------------
(Intercept)             2.03 ***      0.20 ***      1.03 ***
                       (0.06)        (0.02)        (0.02)   
discriminationTRUE     -2.51 ***      0.23 ***     -1.02 ***
                       (0.09)        (0.03)        (0.03)   
occupation                            1.80 ***      0.99 ***
                                     (0.01)        (0.01)   
ability                                             2.01 ***
                                                   (0.02)   
------------------------------------------------------------
R^2                     0.08          0.91          0.95    
Adj. R^2                0.08          0.91          0.95    
Num. obs.           10000         10000         10000       
RMSE                    4.27          1.35          1.00    
============================================================
*** p &lt; 0.001, ** p &lt; 0.01, * p &lt; 0.05</code></pre>
<p>When you’re interpreting these sort of tables, make sure you use the standard errors. The coefficients are estimates, so when making comparisons it is useful to look at the coefficients 95% confidence interval. The 95% confidence interval is just the estimate <span class="math inline">\(\pm\)</span> 2 * the standard error. If the actual value of the parameter is within the confidence interval for the parameter estimate, then we say that the estimate agrees with the actual parameter value.</p>
<p>All of the estimates in <code>mod3</code> line up with the actual parameter values. This model correctly recovers the parameters, so we can be confident that this model is correct.</p>
<p>Before moving on, have a look at the coefficient estimates on the Discrimination term. It changes model to model, which makes sense since both <code>mod1</code> and <code>mod2</code> are incorrectly specified. Look at the coefficient in <code>mod2</code> - it’s a different sign to the others! If you just used <code>mod2</code> to make inferences, you’d conclude that discrimination <em>increases</em> wages. Bias can have huge effects on models, so it’s worth the effort to make sure your model is correct!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>